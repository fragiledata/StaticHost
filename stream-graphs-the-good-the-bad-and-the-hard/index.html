<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Stream Graphs: The Good, the Bad and the Hard - fragiledata.co.uk</title><meta name="description" content="As part of my foray into technically accomplished (though often questionably useful)&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://fragiledata.github.io/StaticHost/stream-graphs-the-good-the-bad-and-the-hard/"><link rel="alternate" type="application/atom+xml" href="https://fragiledata.github.io/StaticHost/feed.xml"><link rel="alternate" type="application/json" href="https://fragiledata.github.io/StaticHost/feed.json"><meta property="og:title" content="Stream Graphs: The Good, the Bad and the Hard"><meta property="og:image" content="https://fragiledata.github.io/StaticHost/media/posts/30/fema_d3_stream.gif"><meta property="og:site_name" content="fragiledata.co.uk"><meta property="og:description" content="As part of my foray into technically accomplished (though often questionably useful)&hellip;"><meta property="og:url" content="https://fragiledata.github.io/StaticHost/stream-graphs-the-good-the-bad-and-the-hard/"><meta property="og:type" content="article"><link rel="stylesheet" href="https://fragiledata.github.io/StaticHost/assets/css/style.css?v=a6950391b9d7a19ed4119a1415d4ddee"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://fragiledata.github.io/StaticHost/stream-graphs-the-good-the-bad-and-the-hard/"},"headline":"Stream Graphs: The Good, the Bad and the Hard","datePublished":"2019-01-08T09:15","dateModified":"2022-05-25T19:02","image":{"@type":"ImageObject","url":"https://fragiledata.github.io/StaticHost/media/posts/30/fema_d3_stream.gif","height":867,"width":1598},"description":"As part of my foray into technically accomplished (though often questionably useful)&hellip;","author":{"@type":"Person","name":"fragiledata","url":"https://fragiledata.github.io/StaticHost/authors/fragiledata/"},"publisher":{"@type":"Organization","name":"fragiledata"}}</script></head><body><div class="container"><header class="header" id="js-header"><a href="https://fragiledata.github.io/StaticHost/" class="logo">fragiledata.co.uk</a></header><main><article class="post wrapper"><header class="hero"><p class="post__meta">By <a href="https://fragiledata.github.io/StaticHost/authors/fragiledata/" rel="author" title="fragiledata">fragiledata</a> Published on <time datetime="2019-01-08T09:15">Tuesday, 8 January 2019</time></p><h1 class="post__title">Stream Graphs: The Good, the Bad and the Hard</h1></header><figure class="post__featured-image post__image--wide"><img src="https://fragiledata.github.io/StaticHost/media/posts/30/fema_d3_stream.gif" loading="eager" height="867" width="1598" alt=""></figure><div class="post__entry"><p>As part of my foray into technically accomplished (though often questionably useful) graphs, one inevitable appearance is made by the Stream graph. Stream graphs first caught public attention with a <a href="http://archive.nytimes.com/www.nytimes.com/interactive/2008/02/23/movies/20080223_REVENUE_GRAPHIC.html?unomas">now infamous viz</a> by the New York Times about box office receipts, but their history is well chronicled by Andy Kirk <a href="http://www.visualisingdata.com/2010/08/making-sense-of-streamgraphs/">here</a>.</p><p>Stream graphs can be generated in a number of different ways according to the platform that you are using, some of which are more hacky than others. Tableau, for example, isn't a massive fan of curved lines (<a href="http://www.vizwiz.com/2011/12/when-you-use-smoothed-line-chart-your.html">since they are not viz best practice</a>) and does not intuitively lead the user towards creating them (e.g. with "Show Me"), while R can wrap around D3 library allowing you to build one in less than 10 lines of code. In this post I'll explore some different ways to make stream graphs, using data from <a href="https://www.fema.gov/">Federal Emergency Management Bureau</a> (FEMA) and the <a href="https://www.splcenter.org/hate-map">Southern Poverty Law Centre</a> (SPLC). I'm using these two data sets because the shape of their data is different; the SPLC is fairly steady but has new categories impacting it about 1/3rd of the way through, while the FEMA data is more erratic and contains a distinct outlier event, which was the impact of the 2015 hurricane season.</p><p><strong>Basic Tableau</strong></p><p>Andy Kriebel <a href="http://www.vizwiz.com/2013/01/creating-stream-graphs-in-tableau-8-in.html">wrote a blog post</a> about how to do a proxy to stream graphs in Tableau 8 a few years ago, which still holds up. At its core a stream graph is essentially an area chart with added obscuring features, so using some data from FEMA here's one using a minimum amount of table calculations and/or scripting. Here I was following <a href="https://www.thedataschool.co.uk/emily-chen/designing-a-stream-graph/">Emily Chen's tutorial</a>, though I decided having dynamic parameters wasn't going to be useful here.</p><figure class="size-full wp-image-411 aligncenter"><img loading="lazy" src="https://fragiledata.github.io/StaticHost/media/posts/30/streamgraph_fema_basictableau.png" sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_fema_basictableau-xs.png 300w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_fema_basictableau-sm.png 480w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_fema_basictableau-md.png 768w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_fema_basictableau-lg.png 1024w" alt="streamgraph_fema_basictableau" width="1920" height="1046"></figure><p>This is passable - it has spread the data over the axis in a way that makes it easy to see that FEMA are getting increasingly called into incidents, and most of those incidents are about natural conditions in some way (the large spike in 2005 relates to that year's <a href="https://en.wikipedia.org/wiki/2005_Atlantic_hurricane_season">hurricane season</a>, as previously noted). However, it lacks the undulating curves which earn the stream graph its name, and the index function to spread the data isn't flawless, as you can see some holes in the chart around the early 00s.</p><figure class="size-full wp-image-413 aligncenter"><img loading="lazy" src="https://fragiledata.github.io/StaticHost/media/posts/30/streamgraph_splc_basictableau.png" sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_splc_basictableau-xs.png 300w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_splc_basictableau-sm.png 480w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_splc_basictableau-md.png 768w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_splc_basictableau-lg.png 1024w" alt="streamgraph_splc_basictableau" width="1911" height="1047"></figure><p>This graph with SPLC data is over a shorter time frame. This also effectively shows the count of hate groups over time in the US as attitudes change in society, and also clearly shows a disruption caused by change in the way the SPLC records groups in 2006. I'm undecided as to whether or not I like them vertical or horizontal, hence the difference in these two.</p><p><em>Best for</em>: getting a proof of concept out of the door.</p><p><strong>Tableau + Enhancements</strong></p><p>Following Alex Jones' <a href="https://public.tableau.com/profile/jusdespommes#!/vizhome/StreamGraph_0/MAKEOVERMONDAY-TRUMPSINTERESTS">popular stream graph entry for Makeover Monday</a> in 2018, Ludovic Tavernier tried reverse engineering it <a href="https://greatified.com/2018/09/17/how-to-build-a-stream-graph-in-tableau-software/">on his blog</a> (and wasn't the only attempt, as per below!). Ludovic's guide reminds me of the calculations for creating Sankey diagrams, and he drew inspiration for it from Rody Zakovich's area bump charts. This requires a little bit of data engineering outside Tableau in order to create a cross join for load of calculations that are required to generate it. Following his tutorial, here's my results for the same FEMA data. Not shown is a lot of googling trying to work out why it's turned out with spaces, if someone can point me in the right direction that would be great.</p><figure class="alignnone size-full wp-image-416"><img loading="lazy" src="https://fragiledata.github.io/StaticHost/media/posts/30/streamgraph_fema_tabenhanced-1.png" sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_fema_tabenhanced-1-xs.png 300w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_fema_tabenhanced-1-sm.png 480w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_fema_tabenhanced-1-md.png 768w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_fema_tabenhanced-1-lg.png 1024w" alt="streamgraph_fema_tabenhanced" width="1433" height="859"></figure><p>And now, the same SPLC data. These do have curved lines in and now start to look more recognisable as stream graphs, as well as cohering together better than the FEMA data.</p><figure class="alignnone size-full wp-image-414"><img loading="lazy" src="https://fragiledata.github.io/StaticHost/media/posts/30/streamgraph_splc_tabenhanced.png" sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_splc_tabenhanced-xs.png 300w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_splc_tabenhanced-sm.png 480w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_splc_tabenhanced-md.png 768w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/streamgraph_splc_tabenhanced-lg.png 1024w" alt="streamgraph_splc_tabenhanced" width="1436" height="879"></figure><p>Here's where we come into the second major issue with these kinds of vizzes in Tableau, which is that nth degrees of calculations often leave you with information which cannot be easily parsed back into an original format, say, to understand how many neo nazi groups the SPLC recorded in 2014. This could be achieved with a dashboard action to one side but I like the intuitiveness of tooltips, and this way requires further work in calculations to get those points to respond to the right information. As you can see, I've decided to settle on horizontal.</p><p><em>Best for</em>: something stylistically similar to famous infographics, but sticking within the tools you may have access to at work.</p><p><strong>Base R</strong></p><p>The Trump stream graph data points were generated in R, but using R is only valid for half the battle (as the rest was in Tableau). The algorithm/mechanics behind the stream graph have been published as academic papers, and this has subsequently led to functions to create the graphs <a href="https://paolotoffanin.wordpress.com/2017/09/02/streamgraphs-translated-into-r/">being built</a> using base R  (i.e. no or very little extra package functions), such as this tutorial by <a href="https://canonicalized.com/streamgraphs-in-tableau-via-r/">Dorian Banutoiu</a> which I followed. However, even if you are familiar with coding, brace yourself, and also tell the machine you're working on to brace itself if it's a laptop or a small PC.</p><figure class="alignnone size-full wp-image-417"><img loading="lazy" src="https://fragiledata.github.io/StaticHost/media/posts/30/base-r-generated-fema.png" sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://fragiledata.github.io/StaticHost/media/posts/30/responsive/base-r-generated-fema-xs.png 300w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/base-r-generated-fema-sm.png 480w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/base-r-generated-fema-md.png 768w, https://fragiledata.github.io/StaticHost/media/posts/30/responsive/base-r-generated-fema-lg.png 1024w" alt="base r generated fema" width="1438" height="881"></figure><p>From end to end it's about 100 lines of code and importantly, does actually feature a way to output a data set which can be loaded into Tableau (as above), as well as being able to customise certain parameters of the stream graph which can affect the result. You'll notice that the axes are numbers, not years or counts, so further work should be done to make sense to humans. Within R, I found the script oddly temperamental (e.g. to generate plots in R to check the result), working for me one evening but not the next with no apparent changes made in between. Because of that, I've only generated the FEMA data for this one.</p><p><em>Best for</em>: embedding something striking within a dashboard that you can add additional context and information to.</p><p><strong>R streamgraphs</strong></p><p>If you enable R:devtools you can access a lot of in-development content for R on GitHub and other repositories, including packages which call D3 libraries to generate complex charts. <a href="https://hrbrmstr.github.io/streamgraph/#fn9">Bob Rudis </a>has made one for stream graphs which, excepting data preparation (to get data into a tidy format), can generate one in less than five lines of code. Here's one with the FEMA data;</p><figure class="alignnone size-full wp-image-419"><img loading="lazy" src="https://fragiledata.github.io/StaticHost/media/posts/30/fema_d3_stream.gif" alt="fema_d3_stream" width="1598" height="867"></figure><p>And here's the same with the SPLC data.</p><figure class="alignnone size-full wp-image-420"><img loading="lazy" src="https://fragiledata.github.io/StaticHost/media/posts/30/splc-d3-gif.gif" alt="splc d3 gif" width="1171" height="869"></figure><p>Saying it only took a short time to code (since there is no formatting in these R plots except picking different colours) makes it sound simple but there were a few rides into <a href="https://twitter.com/fragiledata/status/1082042885900509184">WTH land</a> as I experimented with the package. These are gifs to show the level of interactivity incorporated into the package's functions (label and # at the top left). Most people are probably thinking of something closest to this when they are thinking of a stream graph, and the interactivity of it is smooth. But it is no less essentially confined to a js file and all its peripherals, which makes these fine to add into markdown documents, but not something we can easily export the data or polygons to generate something similar in Tableau.</p><p><em>Best for</em>: reports within something like Rmarkdown, Jupyter notebooks or Shiny apps; D3 also supplies the custom visuals in Power BI, and can be used as an extension in Tableau.</p><p>I hope this review has given you a bit of information about the different ways you can generate stream graphs for your data visualisation - if you have any comments then please <a href="https://twitter.com/fragiledata">let me know.</a></p></div><footer class="post__footer"><div class="post__last-updated">This article was updated on Wednesday, 25 May 2022</div><div class="post__footer__col"><div class="post__share"></div></div><nav class="post__nav"><div class="post__nav__prev">Previous Post<h5><a href="https://fragiledata.github.io/StaticHost/my-first-week-using-alteryx/" class="inverse" rel="prev">My First Week using Alteryx</a></h5></div><div class="post__nav__next">Next Post<h5><a href="https://fragiledata.github.io/StaticHost/fragiles-reading-club-january/" class="inverse" rel="next">Fragile&#x27;s Reading Club: January</a></h5></div></nav></footer></article></main><footer class="footer"><div class="footer__copyright">Powered by Publii</div><div class="footer__social"><a href="www.twitter.com/fragiledata" class="twitter" aria-label="Twitter"><svg class="icon"><use xlink:href="https://fragiledata.github.io/StaticHost/assets/svg/svg-map.svg#twitter"/></svg></a></div></footer></div><script defer="defer" src="https://fragiledata.github.io/StaticHost/assets/js/scripts.min.js?v=b1f07db09e44ca999e985e714f8eba4e"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.navbar'};</script><script>/*<![CDATA[*/var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};/*]]>*/</script></body></html>